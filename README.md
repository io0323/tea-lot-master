# 茶匠ロット (TeaLotMaster) - 茶品質管理システム

## 📖 概要

**茶匠ロット**は、茶製造業向けの品質管理・ロット管理システムです。茶葉の品質スコア（含水率、香り、色）を管理し、統計的異常検知機能により品質問題を早期発見します。

## ✨ 主な機能

### 🔍 品質管理
- **茶ロット管理**: バッチコード、茶種、産地、検査日などの基本情報管理
- **品質スコア**: 含水率、香りスコア、色スコアの記録・分析
- **異常値検知**: 統計的異常検知（平均±2σ）による品質問題の自動検出
- **リアルタイム監視**: グラフ・チャートによる品質トレンドの可視化

### 📊 データ分析・可視化
- **トレンドグラフ**: 日別の含水率・香り・色スコア推移
- **異常値ハイライト**: 異常値の日付を赤色で表示
- **フィルター機能**: サプライヤー、茶種、期間による絞り込み
- **統計分析**: 平均値、標準偏差による品質指標の分析

### 👥 ユーザー管理
- **権限管理**: admin（管理者）、inspector（検査員）、viewer（閲覧者）
- **ロールベースアクセス**: 機能別のアクセス制御
- **日本語UI**: 日本の茶業界に最適化されたインターフェース

### 📱 モバイル対応
- **レスポンシブデザイン**: スマートフォン・タブレット対応
- **タッチフレンドリー**: 大きなボタン・入力フィールド
- **最適化されたレイアウト**: デバイス別の表示調整

### 📄 レポート・エクスポート
- **PDF出力**: 検査報告書の自動生成
- **CSV入出力**: バルクロットデータの一括処理
- **データエクスポート**: 分析用データの出力

## 🛠 技術スタック

### バックエンド
- **Laravel 12**: PHP 8.4.10
- **Filament PHP 3.x**: 管理画面UI
- **SQLite**: データベース（開発環境）
- **Spatie Laravel Permission**: 権限管理

### フロントエンド
- **Tailwind CSS**: スタイリング
- **Alpine.js**: インタラクティブ機能
- **Chart.js**: グラフ・チャート表示

### ライブラリ
- **Barryvdh/laravel-dompdf**: PDF生成
- **Maatwebsite/excel**: CSV入出力
- **Laravel-lang/lang**: 多言語対応

## 🚀 セットアップ

### 前提条件
- PHP 8.3以上
- Composer
- Node.js & NPM

### インストール手順

1. **リポジトリのクローン**
```bash
git clone https://github.com/io0323/tea-lot-master.git
cd tea-lot-master
```

2. **依存関係のインストール**
```bash
composer install
npm install
```

3. **環境設定**
```bash
cp .env.example .env
php artisan key:generate
```

4. **データベース設定**
```bash
php artisan migrate
php artisan db:seed
```

5. **アセットのビルド**
```bash
npm run build
```

6. **サーバー起動**
```bash
php artisan serve
```

### 初期ログイン情報
- **URL**: `http://localhost:8000/admin`
- **メール**: `test@example.com`
- **パスワード**: `password`

## 📁 プロジェクト構造

```
tea-lot-master/
├── app/
│   ├── Filament/
│   │   ├── Resources/          # 管理画面リソース
│   │   └── Widgets/            # グラフ・チャート
│   ├── Http/Middleware/        # 権限管理ミドルウェア
│   └── Models/                 # Eloquentモデル
├── database/
│   ├── migrations/             # データベースマイグレーション
│   └── seeders/                # サンプルデータ
├── resources/
│   └── views/pdf/              # PDFテンプレート
└── config/                     # 設定ファイル
```

## 🔧 主要な機能詳細

### 異常値検知アルゴリズム
```php
// 統計的異常検知（平均±2σ）
private function isAbnormal(string $column, float $value): bool
{
    $values = self::pluck($column)->toArray();
    if (count($values) < 2) return false;
    
    $avg = array_sum($values) / count($values);
    $variance = array_sum(array_map(fn($x) => pow($x - $avg, 2), $values)) / (count($values) - 1);
    $std = sqrt($variance);
    
    return $std > 0 && abs($value - $avg) > 2 * $std;
}
```

### グラフ・チャート機能
- **含水率推移**: 日別平均含水率の可視化
- **香りスコア推移**: 日別平均香りスコアの可視化
- **色スコア推移**: 日別平均色スコアの可視化
- **異常値ハイライト**: 異常値の日付を赤色で表示

### フィルター機能
- **テキスト検索**: ロット番号、茶種、産地
- **セレクトフィルター**: サプライヤー、検査員
- **日付範囲**: 検査日の期間指定
- **数値範囲**: 品質スコアの範囲指定

## 🎯 使用例

### 品質管理ワークフロー
1. **検査員が茶ロットを登録**
   - バッチコード、茶種、産地を入力
   - 含水率、香りスコア、色スコアを測定・記録

2. **システムが自動分析**
   - 統計的異常検知により異常値を検出
   - グラフ上で異常値の日付を赤色でハイライト

3. **管理者が品質問題を確認**
   - ダッシュボードで異常ロットを一覧表示
   - PDFレポートを生成して関係者に共有

### データ分析例
- **含水率異常**: 乾燥工程の問題を早期発見
- **香りスコア低下**: 保存条件や加工工程の改善点を特定
- **色スコア変動**: 原料品質や加工条件の安定性を評価

## 🔒 セキュリティ

- **権限ベースアクセス制御**: ロール別の機能制限
- **CSRF保護**: Laravel標準のセキュリティ機能
- **入力値検証**: フォームバリデーション
- **SQLインジェクション対策**: Eloquent ORM使用

## 📈 パフォーマンス

- **データベース最適化**: インデックス設定
- **キャッシュ機能**: グラフデータのキャッシュ
- **レスポンシブデザイン**: モバイル最適化
- **非同期処理**: Livewireによるリアルタイム更新

## 🤝 貢献

1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 📞 サポート

質問や問題がある場合は、GitHubのIssuesページでお知らせください。

---

**茶匠ロット** - 茶業界の品質管理を革新する
